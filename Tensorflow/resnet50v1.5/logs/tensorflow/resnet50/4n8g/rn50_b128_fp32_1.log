2020-08-26 21:31:52.195375: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
I0826 21:31:53.566670 140540494919424 classifier_trainer.py:180] Base params: {'evaluation': {'epochs_between_evals': 1, 'skip_eval': False, 'steps': None},
 'export': {'checkpoint': None, 'destination': None},
 'mode': None,
 'model': {'learning_rate': {'boundaries': [30, 60, 80],
                             'decay_epochs': None,
                             'decay_rate': None,
                             'examples_per_epoch': 1281167,
                             'initial_lr': None,
                             'multipliers': [1.0, 0.1, 0.01, 0.001],
                             'name': 'piecewise_constant_with_warmup',
                             'scale_by_batch_size': 0.0,
                             'staircase': None,
                             'warmup_epochs': 5},
           'loss': {'label_smoothing': None,
                    'name': 'sparse_categorical_crossentropy'},
           'model_params': {'batch_size': None,
                            'num_classes': 1000,
                            'rescale_inputs': False,
                            'use_l2_regularizer': True},
           'name': 'ResNet',
           'num_classes': 1000,
           'optimizer': {'beta_1': None,
                         'beta_2': None,
                         'decay': 0.9,
                         'epsilon': 0.001,
                         'lookahead': None,
                         'momentum': 0.9,
                         'moving_average_decay': None,
                         'name': 'momentum',
                         'nesterov': None}},
 'model_dir': None,
 'model_name': None,
 'runtime': {'all_reduce_alg': None,
             'batchnorm_spatial_persistent': False,
             'dataset_num_private_threads': None,
             'distribution_strategy': 'mirrored',
             'enable_xla': False,
             'gpu_thread_mode': None,
             'loss_scale': None,
             'mixed_precision_dtype': None,
             'num_gpus': 0,
             'num_packs': 1,
             'per_gpu_thread_count': 0,
             'run_eagerly': False,
             'task_index': -1,
             'tpu': None,
             'worker_hosts': None},
 'train': {'callbacks': {'enable_checkpoint_and_export': True,
                         'enable_tensorboard': True,
                         'enable_time_history': True},
           'epochs': 90,
           'metrics': ['accuracy', 'top_5'],
           'resume_checkpoint': True,
           'set_epoch_loop': False,
           'steps': None,
           'tensorboard': {'track_lr': True, 'write_model_weights': False},
           'time_history': {'log_steps': 1}},
 'train_dataset': {'augmenter': {'name': None, 'params': None},
                   'batch_size': 128,
                   'builder': 'records',
                   'cache': False,
                   'data_dir': None,
                   'download': False,
                   'dtype': 'float32',
                   'file_shuffle_buffer_size': 1024,
                   'filenames': None,
                   'image_size': 224,
                   'mean_subtract': True,
                   'name': 'imagenet2012',
                   'num_channels': 'infer',
                   'num_classes': 'infer',
                   'num_devices': 1,
                   'num_examples': 'infer',
                   'one_hot': False,
                   'shuffle_buffer_size': 10000,
                   'skip_decoding': True,
                   'split': 'train',
                   'standardize': True,
                   'tf_data_service': None,
                   'use_per_replica_batch_size': True},
 'validation_dataset': {'augmenter': {'name': None, 'params': None},
                        'batch_size': 128,
                        'builder': 'records',
                        'cache': False,
                        'data_dir': None,
                        'download': False,
                        'dtype': 'float32',
                        'file_shuffle_buffer_size': 1024,
                        'filenames': None,
                        'image_size': 224,
                        'mean_subtract': True,
                        'name': 'imagenet2012',
                        'num_channels': 'infer',
                        'num_classes': 'infer',
                        'num_devices': 1,
                        'num_examples': 'infer',
                        'one_hot': False,
                        'shuffle_buffer_size': 10000,
                        'skip_decoding': True,
                        'split': 'validation',
                        'standardize': True,
                        'tf_data_service': None,
                        'use_per_replica_batch_size': True}}
I0826 21:31:53.566953 140540494919424 classifier_trainer.py:183] Overriding params: configs/examples/resnet/imagenet/multi_node_gpu.yaml
/home/leinao/tensorflow/models-2.3.0/official/modeling/hyperparams/params_dict.py:431: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  params_dict = yaml.load(dict_or_string_or_yaml_file)
/home/leinao/tensorflow/models-2.3.0/official/modeling/hyperparams/params_dict.py:436: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  params.override(yaml.load(f), is_strict)
I0826 21:31:53.573603 140540494919424 classifier_trainer.py:183] Overriding params: runtime.num_gpus=8
I0826 21:31:53.574196 140540494919424 classifier_trainer.py:183] Overriding params: {'model_dir': '../output', 'mode': 'train_and_eval', 'model': {'name': 'resnet'}, 'runtime': {'run_eagerly': None, 'tpu': None}, 'train_dataset': {'data_dir': '/datasets/ImageNet/tfrecord'}, 'validation_dataset': {'data_dir': '/datasets/ImageNet/tfrecord'}, 'train': {'time_history': {'log_steps': 100}}}
I0826 21:31:53.575912 140540494919424 classifier_trainer.py:189] Final model parameters: {'evaluation': {'epochs_between_evals': 10, 'skip_eval': False, 'steps': None},
 'export': {'checkpoint': None, 'destination': None},
 'mode': 'train_and_eval',
 'model': {'learning_rate': {'boundaries': [30, 60, 80],
                             'decay_epochs': None,
                             'decay_rate': None,
                             'examples_per_epoch': 640512,
                             'initial_lr': 1.024,
                             'multipliers': [1.0, 0.1, 0.01, 0.001],
                             'name': 'piecewise_constant_with_warmup',
                             'scale_by_batch_size': 0.0,
                             'staircase': None,
                             'warmup_epochs': 1},
           'loss': {'label_smoothing': 0.1,
                    'name': 'sparse_categorical_crossentropy'},
           'model_params': {'batch_size': None,
                            'num_classes': 1000,
                            'rescale_inputs': False,
                            'use_l2_regularizer': True},
           'name': 'resnet',
           'num_classes': 1000,
           'optimizer': {'beta_1': None,
                         'beta_2': None,
                         'decay': 0.9,
                         'epsilon': 0.001,
                         'lookahead': None,
                         'momentum': 0.875,
                         'moving_average_decay': None,
                         'name': 'momentum',
                         'nesterov': None}},
 'model_dir': '../output',
 'model_name': None,
 'runtime': {'all_reduce_alg': 'nccl',
             'batchnorm_spatial_persistent': False,
             'dataset_num_private_threads': None,
             'distribution_strategy': 'multi_worker_mirrored',
             'enable_xla': False,
             'gpu_thread_mode': None,
             'loss_scale': None,
             'mixed_precision_dtype': None,
             'num_gpus': 8,
             'num_packs': 1,
             'per_gpu_thread_count': 0,
             'run_eagerly': None,
             'task_index': 0,
             'tpu': None,
             'worker_hosts': '10.11.0.2:11111,10.11.0.3:11111,10.11.0.4:11111,10.11.0.5:11111'},
 'train': {'callbacks': {'enable_checkpoint_and_export': True,
                         'enable_tensorboard': True,
                         'enable_time_history': True},
           'epochs': 1,
           'metrics': ['accuracy', 'top_5'],
           'resume_checkpoint': False,
           'set_epoch_loop': False,
           'steps': 600,
           'tensorboard': {'track_lr': True, 'write_model_weights': False},
           'time_history': {'log_steps': 100}},
 'train_dataset': {'augmenter': {'name': None, 'params': None},
                   'batch_size': 128,
                   'builder': 'records',
                   'cache': False,
                   'data_dir': '/datasets/ImageNet/tfrecord',
                   'download': False,
                   'dtype': 'float32',
                   'file_shuffle_buffer_size': 1024,
                   'filenames': None,
                   'image_size': 224,
                   'mean_subtract': True,
                   'name': 'imagenet2012',
                   'num_channels': 'infer',
                   'num_classes': 1000,
                   'num_devices': 1,
                   'num_examples': 640512,
                   'one_hot': False,
                   'shuffle_buffer_size': 10000,
                   'skip_decoding': True,
                   'split': 'train',
                   'standardize': True,
                   'tf_data_service': None,
                   'use_per_replica_batch_size': True},
 'validation_dataset': {'augmenter': {'name': None, 'params': None},
                        'batch_size': 128,
                        'builder': 'records',
                        'cache': False,
                        'data_dir': '/datasets/ImageNet/tfrecord',
                        'download': False,
                        'dtype': 'float32',
                        'file_shuffle_buffer_size': 1024,
                        'filenames': None,
                        'image_size': 224,
                        'mean_subtract': True,
                        'name': 'imagenet2012',
                        'num_channels': 'infer',
                        'num_classes': 1000,
                        'num_devices': 1,
                        'num_examples': 50000,
                        'one_hot': False,
                        'shuffle_buffer_size': 10000,
                        'skip_decoding': True,
                        'split': 'validation',
                        'standardize': True,
                        'tf_data_service': None,
                        'use_per_replica_batch_size': True}}
I0826 21:31:53.575994 140540494919424 classifier_trainer.py:294] Running train and eval.
2020-08-26 21:31:53.577491: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcuda.so.1
2020-08-26 21:31:58.687407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 0 with properties: 
pciBusID: 0000:1a:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.693484: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 1 with properties: 
pciBusID: 0000:1b:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.699001: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 2 with properties: 
pciBusID: 0000:3d:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.704588: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 3 with properties: 
pciBusID: 0000:3e:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.711244: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 4 with properties: 
pciBusID: 0000:88:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.717501: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 5 with properties: 
pciBusID: 0000:89:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.723835: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 6 with properties: 
pciBusID: 0000:b2:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.729314: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 7 with properties: 
pciBusID: 0000:b3:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:31:58.729358: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-08-26 21:31:58.732560: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10
2020-08-26 21:31:58.735550: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcufft.so.10
2020-08-26 21:31:58.736006: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcurand.so.10
2020-08-26 21:31:58.739345: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusolver.so.10
2020-08-26 21:31:58.741002: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusparse.so.10
2020-08-26 21:31:58.746798: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudnn.so.7
2020-08-26 21:31:58.808267: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1858] Adding visible gpu devices: 0, 1, 2, 3, 4, 5, 6, 7
2020-08-26 21:31:58.810587: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN)to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2020-08-26 21:31:58.841597: I tensorflow/core/platform/profile_utils/cpu_utils.cc:104] CPU Frequency: 2300115000 Hz
2020-08-26 21:31:58.852670: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55b5763327b0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-08-26 21:31:58.852719: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
2020-08-26 21:32:00.984405: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55b575b0e3c0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2020-08-26 21:32:00.984446: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984456: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (1): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984463: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (2): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984470: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (3): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984477: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (4): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984484: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (5): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984491: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (6): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:00.984500: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (7): Tesla V100-SXM2-16GB, Compute Capability 7.0
2020-08-26 21:32:01.016681: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 0 with properties: 
pciBusID: 0000:1a:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.022531: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 1 with properties: 
pciBusID: 0000:1b:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.026869: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 2 with properties: 
pciBusID: 0000:3d:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.031764: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 3 with properties: 
pciBusID: 0000:3e:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.038150: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 4 with properties: 
pciBusID: 0000:88:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.042603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 5 with properties: 
pciBusID: 0000:89:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.046783: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 6 with properties: 
pciBusID: 0000:b2:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.052377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 7 with properties: 
pciBusID: 0000:b3:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:01.052421: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-08-26 21:32:01.052457: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10
2020-08-26 21:32:01.052475: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcufft.so.10
2020-08-26 21:32:01.052493: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcurand.so.10
2020-08-26 21:32:01.052511: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusolver.so.10
2020-08-26 21:32:01.052527: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusparse.so.10
2020-08-26 21:32:01.052543: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudnn.so.7
2020-08-26 21:32:01.145741: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1858] Adding visible gpu devices: 0, 1, 2, 3, 4, 5, 6, 7
2020-08-26 21:32:01.145898: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-08-26 21:32:06.149782: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1257] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-08-26 21:32:06.149868: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1263]      0 1 2 3 4 5 6 7 
2020-08-26 21:32:06.149889: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 0:   N Y Y Y Y Y Y Y 
2020-08-26 21:32:06.149904: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 1:   Y N Y Y Y Y Y Y 
2020-08-26 21:32:06.149919: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 2:   Y Y N Y Y Y Y Y 
2020-08-26 21:32:06.149933: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 3:   Y Y Y N Y Y Y Y 
2020-08-26 21:32:06.149948: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 4:   Y Y Y Y N Y Y Y 
2020-08-26 21:32:06.149974: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 5:   Y Y Y Y Y N Y Y 
2020-08-26 21:32:06.149982: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 6:   Y Y Y Y Y Y N Y 
2020-08-26 21:32:06.149988: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 7:   Y Y Y Y Y Y Y N 
2020-08-26 21:32:06.185319: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14753 MB memory) -> physical GPU (device: 0, name: Tesla V100-SXM2-16GB, pci bus id: 0000:1a:00.0, compute capability: 7.0)
2020-08-26 21:32:06.189191: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 14753 MB memory) -> physical GPU (device: 1, name: Tesla V100-SXM2-16GB, pci bus id: 0000:1b:00.0, compute capability: 7.0)
2020-08-26 21:32:06.192972: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:2 with 14753 MB memory) -> physical GPU (device: 2, name: Tesla V100-SXM2-16GB, pci bus id: 0000:3d:00.0, compute capability: 7.0)
2020-08-26 21:32:06.196244: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:3 with 14753 MB memory) -> physical GPU (device: 3, name: Tesla V100-SXM2-16GB, pci bus id: 0000:3e:00.0, compute capability: 7.0)
2020-08-26 21:32:06.200430: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:4 with 14753 MB memory) -> physical GPU (device: 4, name: Tesla V100-SXM2-16GB, pci bus id: 0000:88:00.0, compute capability: 7.0)
2020-08-26 21:32:06.203924: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:5 with 14753 MB memory) -> physical GPU (device: 5, name: Tesla V100-SXM2-16GB, pci bus id: 0000:89:00.0, compute capability: 7.0)
2020-08-26 21:32:06.207030: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:6 with 14753 MB memory) -> physical GPU (device: 6, name: Tesla V100-SXM2-16GB, pci bus id: 0000:b2:00.0, compute capability: 7.0)
2020-08-26 21:32:06.210607: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:7 with 14753 MB memory) -> physical GPU (device: 7, name: Tesla V100-SXM2-16GB, pci bus id: 0000:b3:00.0, compute capability: 7.0)
2020-08-26 21:32:06.228618: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 0 with properties: 
pciBusID: 0000:1a:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.231347: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 1 with properties: 
pciBusID: 0000:1b:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.233986: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 2 with properties: 
pciBusID: 0000:3d:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.235877: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 3 with properties: 
pciBusID: 0000:3e:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.237364: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 4 with properties: 
pciBusID: 0000:88:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.238853: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 5 with properties: 
pciBusID: 0000:89:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.240326: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 6 with properties: 
pciBusID: 0000:b2:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.241805: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1716] Found device 7 with properties: 
pciBusID: 0000:b3:00.0 name: Tesla V100-SXM2-16GB computeCapability: 7.0
coreClock: 1.53GHz coreCount: 80 deviceMemorySize: 15.78GiB deviceMemoryBandwidth: 836.37GiB/s
2020-08-26 21:32:06.241868: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-08-26 21:32:06.242013: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10
2020-08-26 21:32:06.242037: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcufft.so.10
2020-08-26 21:32:06.242052: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcurand.so.10
2020-08-26 21:32:06.242065: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusolver.so.10
2020-08-26 21:32:06.242077: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcusparse.so.10
2020-08-26 21:32:06.242091: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudnn.so.7
2020-08-26 21:32:06.268205: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1858] Adding visible gpu devices: 0, 1, 2, 3, 4, 5, 6, 7
2020-08-26 21:32:06.269666: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1257] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-08-26 21:32:06.269678: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1263]      0 1 2 3 4 5 6 7 
2020-08-26 21:32:06.269685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 0:   N Y Y Y Y Y Y Y 
2020-08-26 21:32:06.269691: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 1:   Y N Y Y Y Y Y Y 
2020-08-26 21:32:06.269696: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 2:   Y Y N Y Y Y Y Y 
2020-08-26 21:32:06.269702: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 3:   Y Y Y N Y Y Y Y 
2020-08-26 21:32:06.269708: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 4:   Y Y Y Y N Y Y Y 
2020-08-26 21:32:06.269713: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 5:   Y Y Y Y Y N Y Y 
2020-08-26 21:32:06.269719: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 6:   Y Y Y Y Y Y N Y 
2020-08-26 21:32:06.269726: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 7:   Y Y Y Y Y Y Y N 
2020-08-26 21:32:06.283201: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:0 with 14753 MB memory) -> physical GPU (device: 0, name: Tesla V100-SXM2-16GB, pci bus id: 0000:1a:00.0, compute capability: 7.0)
2020-08-26 21:32:06.284710: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:1 with 14753 MB memory) -> physical GPU (device: 1, name: Tesla V100-SXM2-16GB, pci bus id: 0000:1b:00.0, compute capability: 7.0)
2020-08-26 21:32:06.286210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:2 with 14753 MB memory) -> physical GPU (device: 2, name: Tesla V100-SXM2-16GB, pci bus id: 0000:3d:00.0, compute capability: 7.0)
2020-08-26 21:32:06.287716: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:3 with 14753 MB memory) -> physical GPU (device: 3, name: Tesla V100-SXM2-16GB, pci bus id: 0000:3e:00.0, compute capability: 7.0)
2020-08-26 21:32:06.289210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:4 with 14753 MB memory) -> physical GPU (device: 4, name: Tesla V100-SXM2-16GB, pci bus id: 0000:88:00.0, compute capability: 7.0)
2020-08-26 21:32:06.290724: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:5 with 14753 MB memory) -> physical GPU (device: 5, name: Tesla V100-SXM2-16GB, pci bus id: 0000:89:00.0, compute capability: 7.0)
2020-08-26 21:32:06.292223: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:6 with 14753 MB memory) -> physical GPU (device: 6, name: Tesla V100-SXM2-16GB, pci bus id: 0000:b2:00.0, compute capability: 7.0)
2020-08-26 21:32:06.294339: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:7 with 14753 MB memory) -> physical GPU (device: 7, name: Tesla V100-SXM2-16GB, pci bus id: 0000:b3:00.0, compute capability: 7.0)
2020-08-26 21:32:06.319885: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:301] Initialize GrpcChannelCache for job worker -> {0 -> 10.11.0.2:11111, 1 -> 10.11.0.3:11111, 2 -> 10.11.0.4:11111, 3 -> 10.11.0.5:11111}
2020-08-26 21:32:06.330536: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:405] Started server with target: grpc://10.11.0.2:11111
INFO:tensorflow:Enabled multi-worker collective ops with available devices: ['/job:worker/replica:0/task:0/device:CPU:0', '/job:worker/replica:0/task:0/device:XLA_CPU:0', '/job:worker/replica:0/task:0/device:XLA_GPU:0', '/job:worker/replica:0/task:0/device:XLA_GPU:1', '/job:worker/replica:0/task:0/device:XLA_GPU:2', '/job:worker/replica:0/task:0/device:XLA_GPU:3', '/job:worker/replica:0/task:0/device:XLA_GPU:4', '/job:worker/replica:0/task:0/device:XLA_GPU:5', '/job:worker/replica:0/task:0/device:XLA_GPU:6', '/job:worker/replica:0/task:0/device:XLA_GPU:7', '/job:worker/replica:0/task:0/device:GPU:0', '/job:worker/replica:0/task:0/device:GPU:1', '/job:worker/replica:0/task:0/device:GPU:2', '/job:worker/replica:0/task:0/device:GPU:3', '/job:worker/replica:0/task:0/device:GPU:4', '/job:worker/replica:0/task:0/device:GPU:5', '/job:worker/replica:0/task:0/device:GPU:6', '/job:worker/replica:0/task:0/device:GPU:7']
I0826 21:32:06.350466 140540494919424 collective_all_reduce_strategy.py:329] Enabled multi-worker collective ops with available devices: ['/job:worker/replica:0/task:0/device:CPU:0', '/job:worker/replica:0/task:0/device:XLA_CPU:0', '/job:worker/replica:0/task:0/device:XLA_GPU:0', '/job:worker/replica:0/task:0/device:XLA_GPU:1', '/job:worker/replica:0/task:0/device:XLA_GPU:2', '/job:worker/replica:0/task:0/device:XLA_GPU:3', '/job:worker/replica:0/task:0/device:XLA_GPU:4', '/job:worker/replica:0/task:0/device:XLA_GPU:5', '/job:worker/replica:0/task:0/device:XLA_GPU:6', '/job:worker/replica:0/task:0/device:XLA_GPU:7', '/job:worker/replica:0/task:0/device:GPU:0', '/job:worker/replica:0/task:0/device:GPU:1', '/job:worker/replica:0/task:0/device:GPU:2', '/job:worker/replica:0/task:0/device:GPU:3', '/job:worker/replica:0/task:0/device:GPU:4', '/job:worker/replica:0/task:0/device:GPU:5', '/job:worker/replica:0/task:0/device:GPU:6', '/job:worker/replica:0/task:0/device:GPU:7']
INFO:tensorflow:Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
I0826 21:32:06.374434 140540494919424 mirrored_strategy.py:341] Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
INFO:tensorflow:MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:32:06.378522 140540494919424 collective_all_reduce_strategy.py:380] MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:32:06.393341 140540494919424 classifier_trainer.py:310] Detected 32 devices.
W0826 21:32:06.395017 140540494919424 classifier_trainer.py:101] label_smoothing > 0, so datasets will be one hot encoded.
I0826 21:32:06.399610 140540494919424 dataset_factory.py:173] Using augmentation: None
I0826 21:32:06.401651 140540494919424 dataset_factory.py:173] Using augmentation: None
I0826 21:32:06.406951 140540494919424 dataset_factory.py:358] Using TFRecords to load data.
I0826 21:32:06.438154 140540494919424 dataset_factory.py:403] Sharding the dataset: input_pipeline_id=4 num_input_pipelines=0
WARNING:tensorflow:From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/util/dispatch.py:201: sample_distorted_bounding_box (from tensorflow.python.ops.image_ops_impl) is deprecated and will be removed in a future version.
Instructions for updating:
`seed2` arg is deprecated.Use sample_distorted_bounding_box_v2 instead.
W0826 21:32:07.065079 140540494919424 deprecation.py:323] From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/util/dispatch.py:201: sample_distorted_bounding_box (from tensorflow.python.ops.image_ops_impl) is deprecated and will be removed in a future version.
Instructions for updating:
`seed2` arg is deprecated.Use sample_distorted_bounding_box_v2 instead.
I0826 21:32:07.269775 140540494919424 dataset_factory.py:358] Using TFRecords to load data.
I0826 21:32:07.278308 140540494919424 dataset_factory.py:403] Sharding the dataset: input_pipeline_id=4 num_input_pipelines=0
I0826 21:32:08.430999 140540494919424 dataset_info.py:430] Load pre-computed DatasetInfo (eg: splits, num examples,...) from GCS: imagenet2012/5.0.0
I0826 21:32:11.052641 140540494919424 dataset_info.py:361] Load dataset info from /tmp/tmpw3d74zzytfds
I0826 21:32:11.061028 140540494919424 dataset_info.py:401] Field info.description from disk and from code do not match. Keeping the one from code.
I0826 21:32:11.061219 140540494919424 dataset_info.py:401] Field info.citation from disk and from code do not match. Keeping the one from code.
I0826 21:32:11.325370 140540494919424 classifier_trainer.py:329] Global batch size: 4096
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.060163 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.085884 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.111228 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.134685 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.177773 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.201510 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.361544 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.384248 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.407691 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:22.429741 140540494919424 cross_device_ops.py:1085] Collective batch_all_reduce: 1 all-reduces, num_devices = 8, group_size = 32, communication_hint = AUTO, num_packs = 1
I0826 21:39:39.306090 140540494919424 optimizer_factory.py:372] Using Piecewise constant decay with warmup. Parameters: batch_size: 4096, epoch_size: 640512, warmup_epochs: 1, boundaries: [30, 60, 80], multipliers: [1.0, 0.1, 0.01, 0.001]
I0826 21:39:39.306775 140540494919424 optimizer_factory.py:273] Building momentum optimizer with params {'name': 'momentum', 'decay': 0.9, 'epsilon': 0.001, 'momentum': 0.875, 'nesterov': None, 'moving_average_decay': None, 'lookahead': None, 'beta_1': None, 'beta_2': None}
I0826 21:39:39.306911 140540494919424 optimizer_factory.py:281] Using momentum optimizer
2020-08-26 21:39:39.567916: I tensorflow/core/profiler/lib/profiler_session.cc:164] Profiler session started.
2020-08-26 21:39:39.568014: I tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1391] Profiler found 8 GPUs
2020-08-26 21:39:39.568412: W tensorflow/stream_executor/platform/default/dso_loader.cc:59] Could not load dynamic library 'libcupti.so.10.1'; dlerror: libcupti.so.10.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/leinao/gcc-5.5/lib/:/home/leinao/gcc-5.5/lib/::/usr/local/cuda/lib64:/usr/local/nccl_2.7.3-1+cuda10.1_x86_64/lib:/usr/local/openmpi/lib:/usr/local/cuda/lib64:/usr/local/nccl_2.7.3-1+cuda10.1_x86_64/lib:/usr/local/openmpi/lib
2020-08-26 21:39:39.568509: W tensorflow/stream_executor/platform/default/dso_loader.cc:59] Could not load dynamic library 'libcupti.so'; dlerror: libcupti.so: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/leinao/gcc-5.5/lib/:/home/leinao/gcc-5.5/lib/::/usr/local/cuda/lib64:/usr/local/nccl_2.7.3-1+cuda10.1_x86_64/lib:/usr/local/openmpi/lib:/usr/local/cuda/lib64:/usr/local/nccl_2.7.3-1+cuda10.1_x86_64/lib:/usr/local/openmpi/lib
2020-08-26 21:39:39.568529: E tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1441] function cupti_interface_->Subscribe( &subscriber_, (CUpti_CallbackFunc)ApiCallback, this)failed with error CUPTI could not be loaded or symbol could not be found.
I0826 21:39:39.569661 140540494919424 classifier_trainer.py:285] Saving experiment configuration to ../output/params.yaml
INFO:tensorflow:Running Distribute Coordinator with mode = 'independent_worker', cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, environment = None, rpc_layer = 'grpc'
I0826 21:39:39.588038 140540494919424 distribute_coordinator.py:783] Running Distribute Coordinator with mode = 'independent_worker', cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, environment = None, rpc_layer = 'grpc'
WARNING:tensorflow:`eval_fn` is not passed in. The `worker_fn` will be used if an "evaluator" task exists in the cluster.
W0826 21:39:39.588207 140540494919424 distribute_coordinator.py:832] `eval_fn` is not passed in. The `worker_fn` will be used if an "evaluator" task exists in the cluster.
WARNING:tensorflow:`eval_strategy` is not passed in. No distribution strategy will be used for evaluation.
W0826 21:39:39.588277 140540494919424 distribute_coordinator.py:836] `eval_strategy` is not passed in. No distribution strategy will be used for evaluation.
INFO:tensorflow:Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
I0826 21:39:39.595354 140540494919424 mirrored_strategy.py:341] Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
INFO:tensorflow:MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:39:39.596173 140540494919424 collective_all_reduce_strategy.py:380] MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
INFO:tensorflow:Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
I0826 21:39:39.603333 140540494919424 mirrored_strategy.py:341] Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
INFO:tensorflow:MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:39:39.604108 140540494919424 collective_all_reduce_strategy.py:380] MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
WARNING:tensorflow:From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/data/ops/multi_device_iterator_ops.py:601: get_next_as_optional (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Iterator.get_next_as_optional()` instead.
W0826 21:39:41.355644 140540494919424 deprecation.py:323] From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/data/ops/multi_device_iterator_ops.py:601: get_next_as_optional (from tensorflow.python.data.ops.iterator_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Iterator.get_next_as_optional()` instead.
INFO:tensorflow:Collective batch_all_reduce: 161 all-reduces, num_devices = 8, group_size = 32, communication_hint = NCCL, num_packs = 1
I0826 21:39:52.596057 140540494919424 cross_device_ops.py:1079] Collective batch_all_reduce: 161 all-reduces, num_devices = 8, group_size = 32, communication_hint = NCCL, num_packs = 1
INFO:tensorflow:Collective batch_all_reduce: 161 all-reduces, num_devices = 8, group_size = 32, communication_hint = NCCL, num_packs = 1
I0826 21:40:19.121149 140540494919424 cross_device_ops.py:1079] Collective batch_all_reduce: 161 all-reduces, num_devices = 8, group_size = 32, communication_hint = NCCL, num_packs = 1
2020-08-26 21:40:48.755612: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10
2020-08-26 21:40:59.993083: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudnn.so.7
2020-08-26 21:41:40.174652: I tensorflow/core/profiler/lib/profiler_session.cc:164] Profiler session started.
2020-08-26 21:41:40.174774: E tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1441] function cupti_interface_->Subscribe( &subscriber_, (CUpti_CallbackFunc)ApiCallback, this)failed with error CUPTI could not be loaded or symbol could not be found.
WARNING:tensorflow:From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/ops/summary_ops_v2.py:1277: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.
Instructions for updating:
use `tf.profiler.experimental.stop` instead.
W0826 21:41:40.617949 140540494919424 deprecation.py:323] From /home/leinao/anaconda3/envs/tensorflow/lib/python3.7/site-packages/tensorflow/python/ops/summary_ops_v2.py:1277: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.
Instructions for updating:
use `tf.profiler.experimental.stop` instead.
2020-08-26 21:41:40.842531: I tensorflow/core/profiler/internal/gpu/device_tracer.cc:223]  GpuTracer has collected 0 callback api events and 0 activity events. 
2020-08-26 21:41:41.070960: I tensorflow/core/profiler/rpc/client/save_profile.cc:176] Creating directory: ../output/train/plugins/profile/2020_08_26_21_41_40
2020-08-26 21:41:41.195040: I tensorflow/core/profiler/rpc/client/save_profile.cc:182] Dumped gzipped tool data for trace.json.gz to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.trace.json.gz
2020-08-26 21:41:41.576746: I tensorflow/core/profiler/rpc/client/save_profile.cc:176] Creating directory: ../output/train/plugins/profile/2020_08_26_21_41_40
2020-08-26 21:41:41.628955: I tensorflow/core/profiler/rpc/client/save_profile.cc:182] Dumped gzipped tool data for memory_profile.json.gz to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.memory_profile.json.gz
2020-08-26 21:41:41.640072: I tensorflow/python/profiler/internal/profiler_wrapper.cc:111] Creating directory: ../output/train/plugins/profile/2020_08_26_21_41_40Dumped tool data for xplane.pb to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.xplane.pb
Dumped tool data for overview_page.pb to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.overview_page.pb
Dumped tool data for input_pipeline.pb to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.input_pipeline.pb
Dumped tool data for tensorflow_stats.pb to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.tensorflow_stats.pb
Dumped tool data for kernel_stats.pb to ../output/train/plugins/profile/2020_08_26_21_41_40/VS002.kernel_stats.pb

WARNING:tensorflow:Callbacks method `on_train_batch_end` is slow compared to the batch time (batch time: 0.4398s vs `on_train_batch_end` time: 1.0609s). Check your callbacks.
W0826 21:41:41.675584 140540494919424 callbacks.py:328] Callbacks method `on_train_batch_end` is slow compared to the batch time (batch time: 0.4398s vs `on_train_batch_end` time: 1.0609s). Check your callbacks.
I0826 21:42:23.001036 140540494919424 keras_utils.py:133] TimeHistory: 161.68 seconds, 2533.38 examples/second between steps 0 and 100
I0826 21:43:05.661866 140540494919424 keras_utils.py:133] TimeHistory: 42.65 seconds, 9602.84 examples/second between steps 100 and 200
I0826 21:43:50.937891 140540494919424 keras_utils.py:133] TimeHistory: 45.27 seconds, 9047.56 examples/second between steps 200 and 300
I0826 21:44:35.216598 140540494919424 keras_utils.py:133] TimeHistory: 44.28 seconds, 9251.06 examples/second between steps 300 and 400
I0826 21:45:18.480026 140540494919424 keras_utils.py:133] TimeHistory: 43.26 seconds, 9468.45 examples/second between steps 400 and 500
I0826 21:46:01.710956 140540494919424 keras_utils.py:133] TimeHistory: 43.23 seconds, 9475.39 examples/second between steps 500 and 600

Epoch 00001: saving model to ../output/model.ckpt-0001
600/600 - 264s - loss: 5.3782 - accuracy: 0.7002 - top_5_accuracy: 0.7801
INFO:tensorflow:Running Distribute Coordinator with mode = 'independent_worker', cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, environment = None, rpc_layer = 'grpc'
I0826 21:46:04.344594 140540494919424 distribute_coordinator.py:783] Running Distribute Coordinator with mode = 'independent_worker', cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, environment = None, rpc_layer = 'grpc'
WARNING:tensorflow:`eval_fn` is not passed in. The `worker_fn` will be used if an "evaluator" task exists in the cluster.
W0826 21:46:04.344988 140540494919424 distribute_coordinator.py:832] `eval_fn` is not passed in. The `worker_fn` will be used if an "evaluator" task exists in the cluster.
WARNING:tensorflow:`eval_strategy` is not passed in. No distribution strategy will be used for evaluation.
W0826 21:46:04.345121 140540494919424 distribute_coordinator.py:836] `eval_strategy` is not passed in. No distribution strategy will be used for evaluation.
INFO:tensorflow:Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
I0826 21:46:04.352764 140540494919424 mirrored_strategy.py:341] Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
INFO:tensorflow:MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:46:04.353569 140540494919424 collective_all_reduce_strategy.py:380] MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
INFO:tensorflow:Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
I0826 21:46:04.360243 140540494919424 mirrored_strategy.py:341] Using MirroredStrategy with devices ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7')
INFO:tensorflow:MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
I0826 21:46:04.361156 140540494919424 collective_all_reduce_strategy.py:380] MultiWorkerMirroredStrategy with cluster_spec = {'worker': ['10.11.0.2:11111', '10.11.0.3:11111', '10.11.0.4:11111', '10.11.0.5:11111']}, task_type = 'worker', task_id = 0, num_workers = 4, local_devices = ('/job:worker/task:0/device:GPU:0', '/job:worker/task:0/device:GPU:1', '/job:worker/task:0/device:GPU:2', '/job:worker/task:0/device:GPU:3', '/job:worker/task:0/device:GPU:4', '/job:worker/task:0/device:GPU:5', '/job:worker/task:0/device:GPU:6', '/job:worker/task:0/device:GPU:7'), communication = CollectiveCommunication.NCCL
12/12 - 2s - loss: 7.2711 - accuracy: 0.2500 - top_5_accuracy: 0.2710
I0826 21:46:21.947059 140540494919424 classifier_trainer.py:447] Run stats:
{'accuracy_top_1': 0.2499593049287796, 'eval_loss': 7.271062850952148, 'loss': 5.378208637237549, 'training_accuracy_top_1': 0.7002176642417908, 'step_timestamp_log': ['BatchTimestamp<batch_index: 0, timestamp: 1598449181.3190973>', 'BatchTimestamp<batch_index: 100, timestamp: 1598449343.0006344>', 'BatchTimestamp<batch_index: 200, timestamp: 1598449385.6615634>', 'BatchTimestamp<batch_index: 300, timestamp: 1598449430.9375467>', 'BatchTimestamp<batch_index: 400, timestamp: 1598449475.216288>', 'BatchTimestamp<batch_index: 500, timestamp: 1598449518.4798322>', 'BatchTimestamp<batch_index: 600, timestamp: 1598449561.7101977>'], 'train_finish_time': 1598449564.1702526, 'avg_exp_per_second': 6419.2172131706075}
2020-08-26 21:46:26.895808: W tensorflow/core/common_runtime/eager/context.cc:566] Unable to destroy server_ object, so releasing instead. Servers don't support clean shutdown.
